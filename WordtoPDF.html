async function convertToPDF() {
  if (!wordFileInput.files.length) {
    alert('Please select a Word document first.');
    return;
  }

  const file = wordFileInput.files[0];

  try {
    convertBtn.disabled = true;
    loadingDiv.style.display = 'block';

    const arrayBuffer = await file.arrayBuffer();

    // Extract text from Word using mammoth.js
    const result = await mammoth.extractRawText({ arrayBuffer });
    const extractedText = result.value;

    const { PDFDocument, rgb } = PDFLib;
    const pdfDoc = await PDFDocument.create();

    let pageWidth, pageHeight;
    switch (pageSizeSelect.value) {
      case 'Letter':
        pageWidth = 612;
        pageHeight = 792;
        break;
      case 'Legal':
        pageWidth = 612;
        pageHeight = 1008;
        break;
      case 'A4':
      default:
        pageWidth = 595;
        pageHeight = 842;
    }

    if (orientationSelect.value === 'landscape') {
      [pageWidth, pageHeight] = [pageHeight, pageWidth];
    }

    const page = pdfDoc.addPage([pageWidth, pageHeight]);

    const fontSize = 12;
    const margin = 50;
    const { height } = page.getSize();

    const textLines = extractedText.split('\n');

    let y = height - margin;

    for (let line of textLines) {
      if (y < margin) {
        page = pdfDoc.addPage([pageWidth, pageHeight]);
        y = height - margin;
      }

      page.drawText(line, {
        x: margin,
        y: y,
        size: fontSize,
        color: rgb(0, 0, 0),
        maxWidth: pageWidth - 2 * margin,
      });

      y -= fontSize + 6; // Line spacing
    }

    const pdfBytes = await pdfDoc.save();

    const blob = new Blob([pdfBytes], { type: 'application/pdf' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = file.name.replace(/\.[^/.]+$/, '') + '.pdf';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

  } catch (error) {
    console.error('Conversion error:', error);
    alert('Error converting document: ' + error.message);
  } finally {
    loadingDiv.style.display = 'none';
    convertBtn.disabled = false;
  }
}
